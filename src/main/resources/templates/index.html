<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" href="../static/css/styles.css">
    <title>schedule</title>
</head>
<body>

<header>
    <nav th:replace="~{fragments/navbar :: bavigation-bar}"></nav>
</header>

<main>
    <h1>Employees Schedule</h1>

    <div class = "schedule">
        <form th:action = "@{/month-list/}" method="get">
            <label for="daymonth">Select month:</label>
            <input type="month" id="daymonth" name="month">
            <input type="submit">
        </form>

        <form th:action="@{/employee-filter/}" method="get">
            <label for="filteredFirstName">First name: </label>
            <input type="text" id="filteredFirstName" name="firstName">

            <label for="filteredLastName">Last name: </label>
            <input type="text" id="filteredLastName" name="lastName">

            <label for="separateSelect">Seperated name:</label>
            <select name="separatedName" id="separateSelect" required>
                <option value="" disabled selected>Select Seperated</option>
                <option th:each="separate :${separatedList}" th:value="${separate.getId()}" th:text ="${separate.getTitle()}"></option>
            </select>

            <label for="positionSelect">Position name:</label>
            <select name="position" id="positionSelect" required>
                <option value="" disabled selected>Select position</option>
                <option th:each="position :${positionsList}" th:value="${position.getId()}" th:text ="${position.getTitle()}"></option>
            </select>
            <input type="submit">
        </form>

        <table>
            <thead>
            <tr>
                <th colspan="2" th:if="${selectedMonth != null}"
                    th:text="${selectedMonth.getMonth()}">
                </th>
                <div th:each="day : ${daysOfMonth}" th:object="${day}">
                    <th class="dayHeader" th:text="${day.getDayOfMonth()}"></th>
                </div>
                <th class ="detailsHeader">Hours</th>
                <th class ="detailsHeader">Shifts</th>
            </tr>
            </thead>
            <tbody>
            <div th:each = "employeeSchedule : ${monthlyEmployeesSchedule}">
                <tr th:if="${employeeSchedule.key.getFirstName() != null && employeeSchedule.key.getLastName() != null}">
                    <td th:text ="${employeeSchedule.key.fullName}"></td>
                    <td th:if ="${employeeSchedule.key.getPosition() != null}"
                        th:text = "${employeeSchedule.key.getPosition().getTitle()}"></td>
                    <td th:if ="${employeeSchedule.key.getPosition() == null}"
                        th:text = "${'No Set'}"></td>
                    <div th:each="eSchedule, index : ${employeeSchedule.value}" th:object="${eSchedule}">
                        <td th:if="${eSchedule.getShiftStart() == null}" class="emptyDay">
                            <button onclick="openAddSchedule()" th:action="@{/add-schedule/{employee}/month-date/{monthDay}(employee =${employeeSchedule.getKey()}) (monthDay = ${index+1})}"></button>
<!--                            add Schedule-->
                            <div id="addSchedule" class="closeAddSchedule">
                                <button onclick="closeAddSchedule()">X</button>
                                <h3>Add Schedule</h3>
                                <form th:action="@{/add-schedule}" method="post">
                                    <h2 th:text ="${employeeSchedule.getKey().fullName}"></h2>
                                    <h2 th:text ="${selectedMonth.withDayOfMonth(index+1)}"></h2>
                                    <div>
                                        <label for="shiftStartHours"></label>
                                        <input id="shiftStartHours" type="number" name="shiftStartHour">
                                        <label for="shiftStartMinutes"></label>
                                        <input id="shiftStartMinutes" type="number" name="shiftStartMinutes">
                                    </div>
                                    <div>
                                        <label for="shiftEndHour"></label>
                                        <input id="shiftEndHour" type="number" name="shiftEndHour">
                                        <label for="shiftEndMinutes"></label>
                                        <input id="shiftEndMinutes" type="number" name="shiftEndMinutes">
                                    </div>
                                    <div>
                                        <label for="isPresent">Present</label>
                                        <input id="isPresent" type="checkbox" name="isPresent">
                                    </div>
                                    <button type="submit">Add Schedule</button>
                                </form>
                            </div>
<!--                            End Add Schedule-->
                        </td>
                        <td th:if="${eSchedule.getShiftStart() != null}" th:text ="${eSchedule.getDailySchedule()}" class="emptyDay"></td>
                    </div>
                    <div th:each="hours : ${monthlyEmployeesTotalHours}"
                         th:if="${hours.getKey() == employeeSchedule.getKey()}">
                        <td class ="details" th:text ="${hours.getValue().getTotalHours()} + '/' + ${hours.getValue().getMonthlyFullTimeHours()}"></td>
                        <td class ="details" th:text ="${hours.getValue().getShifts()}"></td>
                    </div>
                </tr>
            </div>
            </tbody>
        </table>
    </div>
</main>
<script>
    function openAddSchedule() {
        var element = document.getElementById("addSchedule");
        if (element.classList.contains("closeAddSchedule")) {
            element.classList.remove("closeAddSchedule");
            element.classList.add("openAddSchedule");
        }
    }
    function closeAddSchedule() {
        var element = document.getElementById("addSchedule");
        element.classList.toggle("closeAddSchedule");
    }
</script>
</body>
</html>